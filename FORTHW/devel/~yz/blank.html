<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" href="forth.css" type="text/css">
<title>BLANK. Описание программы</title>
</head>

<body background="pic/grid.gif">

<font size=5>BLANK
<br>интерпретатор простых диалоговых форм</font>
<br>

<div style="color: red; background: rgb(200,200,200); font-weight: bold;">
Примечание (2004 г.). 
<br>Программу BLANK можно считать устаревшей. В представленном виде 
она не компилируется SPF4 без дополнительных переделок. Все полезные идеи, 
которые в ней можно найти, перенесены автором в универсальную библиотеку 
GUI <a href="winlib.html">Winlib</a>, которую можно считать новой 
реинкарнацией Blank.
</div>

<br><a href="blank.html#1">1. Преамбула</a>
<br><a href="blank.html#2">2. Общие принципы</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#21">Запуск</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#22">Строки</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#23">Воображаемая таблица</a>
<br><a href="blank.html#3">3. Команды</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#31">Описание формы</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#32">Элементы управления</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#33">Шрифты</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#34">Форматный вывод</a>
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="blank.html#35">Разное</a>
<br><a href="blank.html#4">4. Для тех, кому проще один раз увидеть, чем сто раз услышать</a>
<br><a href="blank.html#5">5. Недоделки</a>

<br>
<a name="1"></a><h1>1. Преамбула</h1>

<p>Переход на систему Windows давно уже можно считать свершившимся фактом.
Наряду с некоторыми потерями как в оперативной, так и в долговременной
памяти, постигшими ни в чем не подозревающих пользователей, имеются и
приобретения в плане пользовательского интерфейса. Так, получили
распространение отдельные милые элементы интерфейса, как-то: полосы
прокрутки, кнопки, элементы выбора и др., весьма облегчающие простому
человеку общение с компьютером, а специалисту - общение с простым
человеком. Это явление несомненно прогрессивное. Однако добраться до всех
этих кнопочек не так-то просто. Редмондские мыслители, обескураженные,
очевидно, качеством разработанного ими языка для пакетных файлов ДОС,
решили более не испытывать судьбу и отправили Windows в большой свет
вообще без командного языка (дальнейшие попытки исправить ситуацию путем
сочинения т.н. скриптовых хостов и прикручивания к ним тщательно
отобранных языков (напр. Ява-Скрипта, Бейсик-скрипта, хорошо хоть не
Фортран-скрипта) можно положительно оценить разве что с позиций
технического мазохизма). В результате,
программист, желающий всего лишь
показать робкому юзеру маленькое окошко с парой кнопок и списком выбора,
вынужден разворачивать тяжелую артиллерию в виде Дельфи или чего-то в этом
роде и вести с нею затяжные позиционные бои. В общем, идея простого языка,
позволяющего выводить несложные окна со стандартными элементами управления
назрела.
<p>Выражаясь не столь изысканным языком, программа, предлагающаяся Вашему вниманию, была задумана как
средство, позволяющее с минимумом усилий выводить на экран окна диалога, не привлекая
к этому нехитрому занятию ничего лишнего: многостраничных описаний, точного указания координат
каждой кнопки, визуальных редакторов и т.п. При этом предполагалось, что вызывать BLANK будет не столько пользователь,
сколько программы на других языках, лишенные собственного интерфейса (например,
программы на Перле или даже пакетные файлы). Поэтому к минимуму (вызов с именем файла) было сведено управление программой, а 
сам язык описания форм сделан простым и регулярным, чтобы диалоги несложно было генерировать автоматически.

<a name="2"></a><h1>2. Общие принципы</h1>

<a name="21"><h2>Запуск</h2></a>
<p>Программа запускается следующим образом:
<br><br><i>BLANK имя-файла</i>
<br><br>(логично, не правда ли?).
<p>В файле находятся команды описания формы, каковые и исполняются. Обработка ошибок, как
велит традиция Форта, минимальна.

<a name="22"><h2>Строки</h2></a>
<p>Чтобы не возиться с неудобными для работы в среде Windows строками со счетчиком, 
введено слово <u>"</u>, позволяющее описывать стандартные asciiz-строки, то есть строки, завершающиеся нулем. Слово работает как в режиме интерпретации, так и в режиме компиляции. Внутри строк можно использовать cпециальные последовательности на манер языка Си:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>\n</i> Перевод строки
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>\r</i> Возврат каретки
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>\t</i> Табуляция
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>\q</i> Кавычки
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>\\</i> Обратная черта
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>\xxx</i> Символ с десятичным кодом <i>xxx</i>.
<p>Адрес пустой строки оставляет слово <u>""</u>

<div class="e">
<font color=gray>Пример:</font>
<br>
<tt>" Строка, заканчивающаяся нулем\n"</tt>
</div>

<a name="23"><h2>Воображаемая таблица</h2></a>
<p>Чтобы программист не возился с координатами каждой надписи и каждой кнопки, а тем
более ему не приходилось запускать визуальные редакторы, и тыкать эти самые кнопки
вручную, была выбрана следующая модель. На всю форму накладывается воображаемая
таблица, в клетках которой по одному будут располагаться собственно элементы управления.
Число клеток для каждого ряда таблицы указывается отдельно. Некоторые клетки могут быть
пустыми. Для каждой клетки можно указать, сколько процентов от общей ширины формы
она будет занимать и в какую сторону выравнивать ее содержимое. Некоторые элементы (линии,
строки ввода) занимают всю клетку целиком, остальные - лишь ее часть.
Этих простых средств вполне достаточно для удовлетворительного
форматирования диалоговой формы.

<a name="3"></a><h1>3. Команды</h1>

<p>Из-за славянофильского порыва команды программы носят родные русские имена. Их написание чувствительно к регистру, то есть <i>Команда</i> и <i>командА</i>  - это не одно и то же.

<a name="31"></a><h2>Описание формы</h2>

<u>Форма</u> <i>( x y header -- )</i>
<p>Начинает описание формы. Окно формы будет иметь на экране размеры <i>x</i>
на <i>y</i> точек и получит заголовок <i>header</i>.
</p>

<u>Обработчики</u> <i>( -- )</i>
<p>
Конец описания элементов управления и начало описания вспомогательных форт-слов, например проверяющих введенные данные на правильность или записывающие их в файл. Если таковых нет, слово <u>Обработчики</u> можно не ставить.
</p>
<u>Конец-формы</u> <i>( -- )</i>
<p>Выводит форму на экран. Команды, стоящие после конца-формы, не обрабатываются.
</p>

<u>===</u> <i>( n -- )</i>
<p>Начало нового ряда в воображаемой таблице. В ряду будет находиться <i>n</i> ячеек.
<br><u>0 ===</u> означает пустую строку - отступ от предыдущего ряда.</p>

<u>---</u> <i>( n -- )</i>
<p>То же, что и <u>===</u>, только ряд будет находиться чуть ближе к предыдущему. Введено из эстетических соображений.
<br><u>0 ---</u> отступит от предыдущего ряда чуть меньше, чем <u>0 ===</u>.</p>

<u>&lt;&lt;</u> <i>( -- )</i>
<p>Выравнивать элемент из текущей клетки влево. Выравнивание влево стоит по умолчанию, так что <u>&lt;&lt;</u> можно не писать.
</p>

<u>||</u> <i>( -- )</i>
<p>Выравнивание по центру клетки</p>

<u>&gt;&gt;</u> <i>( -- )</i>
<p>Выравнивание вправо</p>

<u>%</u> <i>( n -- )</i>
<p>Текущая ячейка займет n процентов ширины окна</p>

<a name="32"></a><h2>Элементы управления</h2>

<u>пусто</u> <i>( -- )</i>
<p>Пустая клетка. Применяется для красивых отступов.</p>

<u>Надпись</u> <i>( z -- )</i>
<p>Просто надпись в окне. Выводится текущим шрифтом (см. <a href="blank.html#33">Шрифты</a>)</p>

<u>Рисунок</u> <i>( filename -- )</i>
<p>Выводит рисунок формата BMP, хранящийся в файле filename.</p>

<u>Иконка</u> <i>( filename -- )</i>
<p>Выводит рисунок формата ICO, хранящийся в файле filename.</p>

<u>Линия</u> <i>( -- )</i>
<p>Линия, занимающая целиком текущую ячейку.</p>

<u>Квадратик</u> name <i>( label -- )</i>
<p>Check box. Поле с крестиком внутри c подписью <i>label</i>.
name возвращает его текущее значение: 0 не отмечен, -1 отмечен.</p>

<u>Группа</u> name
<p>Начинает группу зависимых кнопок (radio button).
name возвращает номер текущей выбранной кнопки (нумеруются с нуля) или -1, если ни одна кнопка не выбрана.
</p>

<u>Кружок</u> <i>( label -- )</i>
<p>Зависимая кнопка, входящая в последнюю объявленную группу.</p>

<u>Ввод</u> name <i>( n -- )</i>
<p>Поле ввода для строки из <i>n</i> символов. Поле занимает всю текущую ячейку.
name возвращает текущее значение строки (адрес asciiz-строки, хранящейся
для каждого поля отдельно. Менять строку из программы не рекомендуется)
</p>

<u>Ввод-числа</u> name <i>(n -- )</i>
<p>Разновидность поля ввода, принимающая только целые положительные числа.
<i>n</i> - максимальное число цифр в числе.
name возвращает текущее значение (число!) или -1, если строка не введена.
</p>

<u>Список</u> name
<br><i>val1|val2|val3
<br>val4|val5|val6</i>
<br><u>Конец-списка</u>
<p>Стандартный выпадающий список. Значения отделяются друг от друга знаком вертикальной черты и могут записываться в несколько строк. 
После всех значений должна стоять строка "Конец-списка".
name возвращает номер текущего выбранного значения (нумеруются с нуля) или -1, если ни одно значение не выбрано.
</p>

<u>Кнопка</u> name <i>( label -- )</i>
<p>Обычная кнопка, на которую можно нажать. Ширина кнопки определяется по надписи на ней. При нажатии на кнопку вызывается слово, 
установленное через <u>дляКнопки</u>.
</p>

<u>Кнопка-рисунок</u> name <i>( filename -- )</i>
<p>Кнопка с рисунком на ней. Рисунок в формате BMP берется из файла <i>filename</i>.</p>

<u>Кнопка-иконка</u> name <i>( filename -- )</i>
<p>Тоже кнопка, но рисунок в формате ICO.</p>

<a name="33"></a><h2>Шрифты</h2>
<u>Шрифт</u> font <i>( fontname size -- )</i>
<p>Определяет новое слово font, которое при исполнении установит шрифт гарнитуры 
<i>fontname</i> и размера <i>size</i>. Размер шрифта указывается во внутренних единицах Windows, размер 20 примерно соответствует 12 типографским пунктам.
</p>

<u>жирный</u>
<p>Определяемый шрифт будет полужирным.</p>

<u>курсивный</u>
<p>Определяемый шрифт будет курсивным.</p>

<u>подчеркнутый</u>
<p>Определяемый шрифт будет подчеркнутым.</p>

<u>Обычный</u>
<p>Переключиться на стандартный шрифт диалоговых окон.</p>

<div class="e"><font color=gray>Пример</font>
<br><tt>
" Times New Roman Cyr" 20 курсивный подчеркнутый Шрифт таймс
<br>...<br>
таймс " надпись таймсом" Надпись 
<br>
Обычный " надпись обычным шрифтом" Надпись
</tt>
</div>

<a name="34"></a><h2>Форматный вывод</h2>
Форматный вывод находится на совести <a href="printf.html">библиотеки
форматного вывода</a>
printf.f. Добавлено только одно слово:</p>

<u>|).</u> <i>( ... format -- )</i>
<p>Отформатировать строку с помощью <u>|)</u> и вывести ее в окошке.</p>

<a name="35"></a><h2>Разное</h2>
<u>Окошко</u> <i>( str -- )</i>
<p>Вывести окно сообщения (message box).</p>

<u>дляКнопки</u> button <i>( 'word -- )</i>
<p>Назначить кнопке button (описанной одним из слов <u>Кнопка</u>, 
<u>Кнопка-рисунок</u>, <u>Кнопка-иконка</u>) слово, адрес которого находится на 
стеке. Слово будет вызвано, если пользователь нажмет кнопку.</p>

<div class="e">
<font color=gray>Пример:</font>
<br><tt>
Обработчики
<br>: ok-pressed  " Нажата кнопка ОК" Окошко ;
<br>['] ok-pressed дляКнопки ОК</tt>
</div>

<u>приЗакрытии</u>
<p>Вектор, в котором хранится адрес слова, которое будет вызвано, когда пользователь попытается закрыть окно формы (мышкой или по Alt-F4).
</p>

<u>закрыть-окно</u> <i>( -- )</i>
<p>Принудительно закрывает окно формы.</p>

<u>пустая-строка?</u> <i>( 'edit -- ? )</i>
<p>Проверить, пуста ли строка ввода, описанная словом <u>Ввод</u>.</p>

<div class="e">
<font color=gray>Пример</font>
<tt><br>20 Ввод имя
<br>...
<br>: проверить-имя  ['] имя пустая-строка? 
<br>IF " Не введено имя " Окошко THEN ;
</tt>
</div>

<u>изСписка</u> <i>( 'list n -- 0 / str)</i>
<p>Получить элемент списка с номером n (нумерация начинается с нуля).
Если такого элемента нет, возвращается ноль.
Возвращаемая строка находится в незащищенном пространстве словаря 
(попросту в HERE) и ее лучше побыстрее скопировать в какое-нибудь более безопасное место.
</p>
<div class="e">
<font color=gray>Пример</font>
<tt>
<br>Список Цветы
<br>Фиалка|Роза|Нарцисс|Ромашка
<br>&nbsp;
<br>...
<br>: имя-розы  ['] Цветы 1 изСписка Окошко ;
</tt>
</div>

<u>GETENV</u> <i>( var -- value True / False )</i>
<p>Получить значение переменной окружения. Если такой переменной нет, 
возвращается false, если есть - ее значение и true. Возвращаемая строка
находится в незащищенном пространстве словаря (в HERE), поэтому ее 
рекомендуется побыстрее скопировать в более спокойное место</p>

<a name="4"></a><h1>4. Для тех, кому проще один раз увидеть, чем сто раз услышать</h1>
<pre><tt><i>
\ BLANK - это обыкновенная Форт-система на основе SP-Forth 3.7
\ Андрея Черезова со всеми вытекающими отсюда последствиями.
\ В частности, она чувствительна к регистру букв :-(
\ Комментарии начинаются с обратной дробной черты
( или пишутся в круглых скобках)

\ до начала самой формы можно описать какие-нибудь служебные переменные 
\ или определить шрифты</i>
" Times New Roman Cyr" 20 Шрифт таймс
" Times New Roman Cyr" 20 жирный Шрифт таймс-жирный
<i>
\ начало формы. Указываются ее размеры и название</i>
700 800 " Пример" Форма

<i>\ в первом ряду будет два элемента</i>
2 ===

<i>\ первый из них - просто надпись</i>
таймс
" Просто надпись" Надпись

<i>\ второй - надпись жирным шрифтом</i>
таймс-жирный
" надпись жирным шрифтом" Надпись
Обычный <i>\ вернемся к обыкновенному шрифту - он ничуть не хуже</i>

<i>\ начинаем второй ряд</i>
3 ===

<i>\ начинаем с картинки</i>
10 % <i>\ места она займет немного - всего десять процентов ширины окна</i>
(| " windir" GETENV " %s\\Треугольники.bmp" |) Рисунок

<i>\ а теперь тоже картинка, только из файла другого типа</i>
" blank.ico" Иконка

<i>\ отчеркнем все это линией</i>
1 ===      
Линия 

3 ===     

<i>\ Элементы в клетке можно выравнивать</i>
&lt;&lt; " влево" Надпись
<i>\ все элементы выравниваются влево по умолчанию, 
\ так что &lt;&lt; можно и не ставить</i>

|| " по центру" Надпись
>> " вправо" Надпись

1 ===
Линия

<i>\ стандартные элементы управления</i>
2 ===

" check box" Квадратик кв1  <i>\ не знаю, как он официально называется
\ Такой квадрат, в котором мышкой отмечают</i>

<i>\ Ну это понятно. Выпадающий список</i>
Список список1
А это|значения|из списка|Они разделяются|символом|вертикальной черты
Список|может занимать|несколько строк
Конец-списка

\ пропустим для красоты одну строку</i>
0 ===

4 ===

10 % " строка: " Надпись
10 Ввод строка1  <i>\ строка ввода на 10 символов</i>

>> " число: " Надпись
3 Ввод-числа число1  <i>\ строка для ввода трехзначного числа</i>

0 ===

<i>\ а теперь - то, что по английски почему-то именуется radio buttons
\ сразу встают перед глазами эфирные волны, антенны и Попов с бородой :-)</i>
3 ===
Группа кнопки1  <i>\ Это слово еще ничего не рисует
\ Оно только объявляет следующие кнопки взаимозависимыми</i>
" Значение1" Кружок
" Значение2" Кружок
" Значение3" Кружок
<i>\ а вот это уже сами кнопки</i>

0 ===

<i>\ Теперь настоящие кнопки, не какие-нибудь радио</i>
3 ===
<i>\ это обычная кнопка с надписью</i>
|| "    OK   " Кнопка ок
<i>\ Это кнопка с иконкой. Еще бывают кнопки с картинками .bmp</i>
|| " blank.ico" Кнопка-иконка ок1

|| " закрыть" Кнопка закрыть 

<i>\ Описание формы на этом завершено. Теперь начинается раздел обработчиков
\ а попросту говоря - обыкновенных слов, написанных на чистом Форте
\ Слова эти, вызываемые по нажатию описанных выше кнопок, могут делать все, 
\ что угодно - проверять введенные значения, записывать их в файл и т.д.</i>

Обработчики

: show-values
  (| 
   кв1 строка1 число1 список1 кнопки1
   " Квадрат=%d Строка=\q%s\q Число=%d Список=%d Кнопки=%d"
  |) Окошко
;

<i>\ значения будут показываться при нажатии на одну из кнопок</i>
' show-values  дляКнопки ок
' show-values  дляКнопки ок1

<i>\ а эта кнопка попросту закроет окно</i>
' закрыть-окно дляКнопки закрыть

<i>\ ну и наконец запустим саму форму</i>
Конец-формы
<i>
\ а здесь уже писать бесполезно. Управление сюда никогда не доходит.</i>
</pre>
</tt>

<a name="5"></a><h1>5. Недоделки</h1>
<ol>
<li>Модель воображаемой таблицы не годится, когда стоит очень большой рисунок или
очень крупная надпись. Поскольку высота строки сейчас фиксирована, последующие 
элементы будут наезжать на надпись. Заранее же определить нужную высоту строки 
за один проход невозможно.
<li>Для полной гармонии неплохо бы сделать вложенные друг в друга клетки, но
я сомневаюсь в их практичности и необходимости.
</ol>

</body>
</html>