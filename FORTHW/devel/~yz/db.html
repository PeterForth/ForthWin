<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" href="forth2.css" type="text/css">
<title>Пользовательский интерфейс для ODBC</title>
</head>

<body background="pic/grid.gif">

 <h1 class=lib><u>DB</u>
 &nbsp;Пользовательский интерфейс для ODBC
 </h1>



<br><br>
<DIV class=toc>

<a href="db.html#intro"><font size=+1>1.</font> <b>Введение</b></a><br>


<a href="db.html#forms"><font size=+1>2.</font> <b>Формы и элементы</b></a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#form-create"><b>2.1.</b> Создание и загрузка форм</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#form-info"><b>2.2.</b> Информация о форме</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#form-std"><b>2.3.</b> Стандартные слова формы</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#form-el"><b>2.4.</b> Элементы</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#form-global"><b>2.5.</b> Общие операции</a><br>


<a href="db.html#data"><font size=+1>3.</font> <b>Взаимодействие между формами</b></a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#data-global"><b>3.1.</b> Глобальные переменные</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#data-call"><b>3.2.</b> Вызов слов формы</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#data-exchange"><b>3.3.</b> Обмен данными</a><br>


<a href="db.html#extensions"><font size=+1>4.</font> <b>Расширения</b></a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#ext-gui"><b>4.1.</b> Пользовательский интерфейс</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#ext-db"><b>4.2.</b> Загрузка информации из базы</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#ext-date"><b>4.3.</b> Работа с датами</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#ext-money"><b>4.4.</b> Работа с денежными суммами и другие слова</a><br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="db.html#ext-sql"><b>4.5.</b> Форматирование запросов</a><br>

</DIV>


<a name="intro"></a>
<h2><font size=+1>1.</font> Введение</h2>


<p>Программа, предлагаемая вашему вниманию, предназначена для решения 
одной частной, но важной и нередко встречающейся задачи - создания 
пользовательского интерфейса для обращения к базам данных. 
<p>Когда автор впервые столкнулся с необходимостью использования базы 
данных в реальной системе, перед ним встала дилемма: применять MS Access, 
в котором все находится в одном флаконе, включая интерфейс, или 
попробовать одну из свободных СУБД. Даже краткий опыт эксплуатации Access 
показал, что особо рассчитывать на него не стоит. Глючность, огромные 
размеры как самой программы, так и получающихся баз, общая ориентация на, 
мягко говоря, неспециалистов, перегруженность базы всяческими излишествами 
и одновременно полное отсутствие гибкости, отсутствие возможностей для 
масштабирования, а также необходимость  
использования чудовищного Визуального Бейсика навсегда отвратили меня от 
использования замечательного редмондского изобретения.
<p>После этого я скачал MySQL, которым как СУБД остался весьма доволен, в 
каковом состоянии пребываю и по сей день. Однако сразу встал вопрос: что 
делать с пользовательским интерфейсом? Заставить обычного пользователя 
набирать в командной строке запросы SQL было бы садизмом. Готового 
свободного интерфейса я не нашел. На самом сайте MySQL имеется, правда, 
некоторый интерфейс, но он почему-то наотрез отказался запускаться на моей 
машине. Гораздо удобнее оказался <a href="http://www.mysqlfront.de">MySQL 
Front</a>, но, к сожалению, он уже не поддерживается автором. Кроме того, 
это универсальный, то есть не подогнанный под конкретную задачу, 
интерфейс. Он очень удобен для администратора БД, но не годится 
пользователю. Так что пришлось в очередной раз призывать старый добрый 
Форт.
<p>Задача построения пользовательского интерфейса сразу показалась 
несложной. Есть готовая библиотека доступа к ODBC (даже две - моя и Андрея 
Черезова) и существует библиотека пользовательского интерфейса. Однако 
первая же написанная в таком духе программа показала, что задача несколько 
сложнее, чем кажется. Первая программа нормально работала, но на ее 
написание ушло несколько недель (не полных, но все-таки...), а сама 
программа оказалась длинной и плохо пригодной для модификации. Сложности  
состояли в следующем: 1) обращаться к самой базе оказалось довольно 
долго; 2) надоедало придумывать каждому элементу интерфейса собственное 
имя; 3) сразу выявились типовые операции, которые приходилось каждый раз 
выполнять заново; 4) описывать все окна в одной программе совершенно 
неудобно, поскольку логически это совершенно разные объекты.
<p>Следующим вариантом стало написание специализированной программы - базы 
для описания конкретных интерфейсов. Каждое логическое окно выделено в 
самостоятельный объект - форму, состоящую из отдельных элементов. Элементы 
умеют выполнять типовые операции - создаваться, загружать в себя данные, 
выгружать свои данные в специальное место, проверять введенные в них 
данные на правильность. Весь интерфейс разбивается на отдельные формы, 
которые могут взаимодействовать между собой.

<a name="forms"></a>
<h2><font size=+1>2.</font> Формы и элементы</h2>

<p>Форма - это независимый объект, располагающий собственным окном. Каждая 
форма хранится в отдельном файле. Формы 
могут загружать друг друга или использовать друг друга в качестве 
модального окна, и свободно взаимодействовать между собой. Некоторые формы 
рассчитаны только на работу в составе другой формы. Такие формы мы будем 
называть подформами. Форма, 
указанная в командной строке, загружается первой. В ее обязанности входит 
открыть базу, занеся ее в переменную <i>database</i> и
загрузить все остальные формы, нужные для работы. Данные и слова каждой 
формы хранятся в отдельном временном словаре Форта. 

<a name="form-create"></a>
<h3>2.1. Создание и загрузка форм</h3>


<DIV class=word>
<u>FORM:</u> <i>( ->bl; -- old-wid )</i>
<br>

Начинает объявление новой формы с указанным именем.
</DIV>


<DIV class=word>
<u>FORM;</u> <i>( old-wid -- form )</i>
<br>

Конец объявления новой формы. На стеке остается дескриптор формы (фактически ее
временный словарь).
</DIV>


<DIV class=word>
<u>NEW-FORM</u> <i>( S" file" --  )</i>
<br>

Загружает форму из указанного файла. Форма обязана иметь 
<a href="db.html#form-std">стандартные переменные и слова</a>
 <i>form-title</i>, 
<i>form-grid</i>, <i>form-name</i> и может иметь также
<i>form-noclose</i>, <i>form-window-init</i>, <i>form-icon</i>, 
<i>form-smicon</i>. Формы различаются по именам.
</DIV>


<DIV class=word>
<u>SUB-FORM</u> <i>( data S" file" -- subform )</i>
<br>

Загружает подформу из указанного файла. Возвращает дескриптор подформы. 
Подформы различаются по дескрипторам, поэтому одна и та же подформа может 
иметь несколько отдельных экземпляров. Для подформы не создается 
отдельного окна, все ее элементы встраиваются в родительскую форму на 
правах вложенной сетки. <i>data</i> - адрес структуры для обмена данными 
между подформой и родительской формой. Он заносится в переменную <i>form-data</i> подформы. Кроме этой 
переменной подформа обязана также иметь слово <i>form-grid</i>.
</DIV>


<DIV class=word>
<u>MODAL-FORM</u> <i>( data S" file" --  )</i>
<br>

Загружает подформу из указанного файла и создает для нее отдельное 
модальное окно. Подформа, вызываемая как модальное окно, обязана 
дополнительно иметь переменную <i>form-title</i>. В остальном модальная 
форма ничем не отличается от вставляемой в родительскую.
</DIV>


<DIV class=word>
<u>UNLOAD-FORM</u> <i>( S" name" -- )</i>
<br>

Выгружает форму из памяти и уничтожает ее окно. Перед уничтожением формы 
вызывает ее слово <i>form-destroy</i>, которое должно освободить все 
запрошенные формой ресурсы - очистить память, выгрузить подформы.
</DIV>


<DIV class=word>
<u>UNLOAD-SUBFORM</u> <i>( subform --  )</i>
<br>

Выгружает подформу из памяти. Перед выгрузкой вызывается 
<i>form-destroy</i> подформы.
</DIV>


<a name="form-info"></a>
<h3>2.2. Информация о форме</h3>


<DIV class=word>
<u>get-form</u> <i>( S" form" -- form )</i>
<br>

Возвращает по имени формы ссылку на саму форму (собственно, на ее 
словарь).
</DIV>


<DIV class=word>
<u>get-form-win</u> <i>( S" form" -- win )</i>
<br>

Возвращает по имени формы ссылку на ее окно (окно в понимании WinLib).
</DIV>


<DIV class=word>
<u>get-form-grid</u> <i>( S" form" -- grid )</i>
<br>

Возвращает по имени формы ссылку на ее сетку.
</DIV>


<DIV class=word>
<u>get-subform-grid</u> <i>( S" form" -- grid )</i>
<br>

Возвращает ссылку на сетку подформы.
</DIV>


<a name="form-std"></a>
<h3>2.3. Стандартные слова формы</h3>

<p>Каждая форма обязана предоставить в распоряжение интерпретатора 
некоторые стандартные слова, в которых содержится нужная информация. 
Список этих слов различается в зависимости от использования формы. Слова 
<i>form-name</i> и <i>form-elements</i> создаются автоматически словом 
<u>FORM:</u>. О них волноваться программисту не надо.
</p>

<DIV class=word>
<u>form-title</u> <i>(  -- z )</i>
<br>

Заголовок окна формы. Можно не указывать для подформ, которые не будут 
загружаться в отдельные окна (то есть будут использоваться только через <u>SUB-FORM</u>).
</DIV>


<DIV class=word>
<u>form-grid</u> <i>(  -- grid )</i>
<br>

Сетка формы с упакованными в нее элементами.
</DIV>


<DIV class=word>
<u>form-data</u> <i>(  -- a )</i>
<br>

Переменная для хранения ссылки на данные формы. Как правило, для обмена 
данными между формой и ее дочерними подформами используется хэш-таблица.
Ее адрес и хранится в этой переменной.
</DIV>


<DIV class=word>
<u>form-destroy</u> <i>(  --  )</i>
<br>

Слово, вызываемое перед уничтожением формы. Должно подчистить все следы ее 
деятельности - закрыть файлы, освободить память и объекты Windows, и т.д.
</DIV>


<DIV class=word>
<u>form-icon</u> <i>(  -- hicon )</i>
<br>

Большая иконка для окна формы. Имеет смысл только для форм, но не для 
подформ.
</DIV>


<DIV class=word>
<u>form-smicon</u> <i>(  -- hicom )</i>
<br>

Маленькая иконка для окна формы.
</DIV>


<DIV class=word>
<u>form-noclose</u> <i>(  --  )</i>
<br>

Пустое слово. Если оно присутствует в форме, ее окно по нажатию на кнопку 
"закрыть" будет сворачиваться, а не закрываться.
</DIV>


<DIV class=word>
<u>form-window-init</u> <i>( win --  )</i>
<br>

Используется для форм. Здесь задается реакция, выполняющаяся между 
созданием окна форма и его показом на экране. Может быть использовано, 
например, чтобы развернуть окно на весь экран или поставить его в 
определенное место экрана.
</DIV>


<a name="form-el"></a>
<h3>2.4. Элементы</h3>

<p>Каждая форма или подформа состоит из отдельных элементов. Элемент - это 
элемент управления (в терминах WinLib), имеющий собственное имя, и умеющий 
выполнять несколько стандартных операций: создать свой экранный элемент, 
загрузить в него данные, выгрузить введенные данные, проверить введенные 
данные на правильность. Из этого списка обязательной является только 
операция создания элемента.
</p>

<DIV class=word>
<u>ELEMENT:</u> <i>( ->bl; --  )</i>
<br>

Начать описание нового элемента с указанным именем.
</DIV>


<DIV class=word>
<u>ELEMENT;</u> <i>(  --  )</i>
<br>

Закончить описание элемента. 
</DIV>


<DIV class=word>
<u>create:</u> <i>(  --  )</i>
<br>

Начать описание кода, который создаст экранный элемент и запомнит его с 
помощью слова <u>me!</u>. Заканчивается это описание словом <u>;</u>.
</DIV>


<DIV class=word>
<u>load:</u> <i>(  --  )</i>
<br>

Описание кода, который загрузит в экранный элемент управления необходимые 
данные. Обычно эти данные хранятся в переменной формы <i>form-data</i>.
</DIV>


<DIV class=word>
<u>unload:</u> <i>(  --  )</i>
<br>

Описание кода, который выгрузит введенные пользователем данные в место 
хранения данных (обычно это <i>form-data</i>).
</DIV>


<DIV class=word>
<u>clear:</u> <i>(  --  )</i>
<br>

Описывает код, который сбросит содержимое элемента.
</DIV>


<DIV class=word>
<u>invalid:</u> <i>( -- ? )</i>
<br>

Описывает код, который проверит введенные пользователем данные на 
правильность и вернет соответствующий флажок. Если нужно уведомить 
пользователя о неправильных данных, это надо сделать здесь же.
</DIV>


<DIV class=word>
<u>me!</u> <i>( ctl --  )</i>
<br>

Присвоить указанный элемент управления текущему элементу.
</DIV>


<DIV class=word>
<u>me</u> <i>( -- ctl )</i>
<br>

Текущий элемент управления.
</DIV>


<DIV class=word>
<u>myname</u> <i>( -- name-a name-# )</i>
<br>

Имя текущего элемента. Может быть использовано, например, при 
загрузке/выгрузке данных.
</DIV>


<a name="form-global"></a>
<h3>2.5. Общие операции</h3>


<DIV class=word>
<u>create-all</u> <i>( form-elements --  )</i>
<br>

Создает все видимые элементы формы. Передается содержимое переменной 
<i>form-elements</i>.
</DIV>


<DIV class=word>
<u>clear-all</u> <i>( form-elements --  )</i>
<br>

Очищает все элементы формы.
</DIV>


<DIV class=word>
<u>load-all</u> <i>( form-elements --  )</i>
<br>

Загружает данные во все элементы.
</DIV>


<DIV class=word>
<u>unload-all</u> <i>( form-elements --  )</i>
<br>

Выгружает данные из всех элементов.
</DIV>


<DIV class=word>
<u>are-invalid</u> <i>( form-elements -- ? )</i>
<br>

Проверяет, что во все элементы введены правильные данные.
</DIV>


<a name="data"></a>
<h2><font size=+1>3.</font> Взаимодействие между формами</h2>

<a name="data-global"></a>
<h3>3.1. Глобальные переменные</h3>

<p>В программе имеется пять глобальных переменных с невыразительными 
именами <i>V1, V2, V3, V4, V5</i>. Они не предназначены для передачи 
данных между формами, их назначение - хранить какие-то данные, 
устанавливаемые в главной форме и используемые во всех остальных формах, 
например, дескриптор шрифта или цвет фона. Кроме этого, имеется служебная 
переменная <i>debug</i>, применяемая для отладки. Если ее значение не 
равно нулю, элементы при выгрузке данных пишут на консоль свое имя.

<a name="data-call"></a>
<h3>3.2. Вызов слов формы</h3>

<p>Формы могут взаимодействовать друг с другом, вызывая заранее 
определенные слова. Программа не налагает никаких ограничений на формат 
слов и их работу.
</p>

<DIV class=word>
<u>FORMEXEC</u> <i>( ... S" word" form -- ... )</i>
<br>

Выполнить слово <i>word</i> из формы <i>form</i>. Слову могут быть 
переданы на стеке любые аргументы, оно может возвратить любые результаты.
Если слово не найдено, это считается фатальной ошибкой и выполнение 
программы прекращается.
</DIV>


<DIV class=word>
<u>?FORMEXEC</u> <i>( ... S" word" form -- F / ... T )</i>
<br>

Выполнить слово из формы. Возвращается <u>TRUE</u> поверх результатов 
работы, если слово найдено, <u>FALSE</u> - если слово не найдено.
</DIV>


<DIV class=word>
<u>WCALL</u> <i>( form zword --  )</i>
<br>

Вызов слова из формы. <i>Word</i> представлено ASCIIZ-строкой.
</DIV>


<DIV class=word>
<u>FCALL</u> <i>( zform zword --  )</i>
<br>

Вызов слова из формы. Форма представлена своим именем (как 
ASCIIZ-строкой).
</DIV>


<DIV class=word>
<u>SCALL</u> <i>( zform zvar zword --  )</i>
<br>

Косвенный вызов. В форме с именем <i>zform</i> хранится переменная 
<i>zvar</i>. Содержимое этой переменной - подчиненная форма. Из это 
подформы вызывается слово <i>zword</i>.
</DIV>


<a name="data-exchange"></a>
<h3>3.3. Обмен данными</h3>

<p>Родительская форма, вызывая подчиненную форму, обычно передает при 
вызове хэш-таблицу, в которой хранятся начальные значения элементов. Туда 
же сгружаются данные, введенные пользователем. Подформа получает доступ к 
этим данным через переменную <i>form-data</i>. Для упрощения работы 
определены следующие слова:
</p>

<DIV class=word>
<u>data!</u> <i>( n S" name" data --  )</i>
<br>

Запомнить число <i>n</i> под именем <i>name</i>.
</DIV>


<DIV class=word>
<u>data!z</u> <i>( z S" name" data --  )</i>
<br>

Запомнить строку <i>z</i> под именем <i>name</i>.
</DIV>


<DIV class=word>
<u>data!text</u> <i>( ctl S" name" data --  )</i>
<br>

Запомнить содержимое элемента управления <i>ctl</i> (которое обязано быть строкой)
под именем <i>name</i>.
</DIV>


<DIV class=word>
<u>data!table</u> <i>( x y ctl S" name" data --  )</i>
<br>

Запомнить содержимое ячейки таблицы <i>ctl</i> под именем <i>name</i>.
</DIV>


<DIV class=word>
<u>data!combo</u> <i>( n S" name" data --  )</i>
<br>

Запомнить текущее выделенное значение выпадающего списка <i>ctl</i> под именем <i>name</i>.
</DIV>


<DIV class=word>
<u>data@</u> <i>( S" name" data -- n )</i>
<br>

Прочитать из блока данных по имени <i>name</i> число <i>n</i>.
</DIV>


<DIV class=word>
<u>data</u> <i>( S" name" data -- z )</i>
<br>

Прочитать из блока данных по имени <i>name</i> строку <i>z</i>.
</DIV>


<DIV class=word>
<u>data</u> <i>( S" name" data -- n )</i>
<br>

Прочитать из блока данных по имени <i>name</i> строку и преобразовать ее в число <i>n</i>.
</DIV>


<DIV class=word>
<u>data</u> <i>( S" name" data ctl -- )</i>
<br>

Прочитать из блока данных по имени <i>name</i> строку и записать ее в 
элемент управления <i>ctl</i>.
</DIV>


<DIV class=word>
<u>data</u> <i>( S" name" data ctl -- )</i>
<br>

Прочитать из блока данных по имени <i>name</i> число, преобразовать его в строку и записать в элемент управления <i>ctl</i>.
</DIV>


<a name="extensions"></a>
<h2><font size=+1>4.</font> Расширения</h2>

<p>В этом разделе собраны удобные расширения. В принципе, без них можно и 
обойтись, ничего концептуально нового к программе они не добавляют, но 
использовать их удобнее, чем не использовать.

<a name="ext-gui"></a>
<h3>4.1. Пользовательский интерфейс</h3>


<DIV class=word>
<u>skip</u> <i>(  --  )</i>
<br>

Вертикальный отступ в 10 точек.
</DIV>


<DIV class=word>
<u>space</u> <i>( n --  )</i>
<br>

Горизонтальный отступ в <i>n</i> точек.
</DIV>


<DIV class=word>
<u>gap</u> <i>(  --  )</i>
<br>

Горизонтальный отступ в 20 точек.
</DIV>


<DIV class=word>
<u>load-icon</u> <i>( zname -- hicon )</i>
<br>

Загрузить иконку по имени файла.
</DIV>


<DIV class=word>
<u>edit-resize</u> <i>( n ctl --  )</i>
<br>

Увеличить размер поля ввода, чтобы оно могло вместить <i>n</i> символов.
</DIV>


<DIV class=word>
<u>edit-readonly</u> <i>( ? ctl --  )</i>
<br>

Включить/выключить режим "только для чтения" для поля ввода.
</DIV>


<DIV class=word>
<u>edit-only-numbers</u> <i>( ctl --  )</i>
<br>

Включить для поля ввода режим "принимать только цифры".
</DIV>


<DIV class=word>
<u>calendar1</u> <i>(  --  )</i>
<br>

Создать элемент управления - календарь, в котором текущий день НЕ будет 
обводиться кружком.
</DIV>


<DIV class=word>
<u>striped-table</u> <i>(  -- ctl )</i>
<br>

Создает расчерченную таблицу. В сущности, это элемент управления, известный в 
Windows под названием ListView. В одном из режимов он выглядит как 
красивая таблица и хорошо подходит для представления данных из базы.
</DIV>


<DIV class=word>
<u>((</u> <i>(  --  )</i>
<br>

Начать создание блока данных. Блок данных размещается на стеке.
</DIV>


<DIV class=word>
<u>))</u> <i>(  -- endofblock beginofblock )</i>
<br>

Закончить создание блока данных.
</DIV>


<DIV class=word>
<u>table-columns</u> <i>( endofblock beginofblock ctl --  )</i>
<br>

Добавить в таблицу колонки, информация о которых хранится в блоке данных 
на стеке. Число данных должно быть четным, в них хранится последовательно 
строка - название колонки и ее ширина.
</DIV>


<code>
<pre>
striped-table TO tb
(( " Имя" 30 " Фамилия" 40 )) tb add-columns
</pre>
</code>

<DIV class=word>
<u>column-right</u> <i>( col ctl --  )</i>
<br>

Устанавливает для колонки <i>col</i> таблицы <i>ctl</i> выравнивание 
вправо.
</DIV>


<a name="ext-db"></a>
<h3>4.2. Загрузка информации из базы</h3>

<p>Приведенные в этом разделе слова загружают информацию из базы данных. 
Запрос к базе задается в виде ASCIIZ-строки.
</p>

<DIV class=word>
<u>ask-number</u> <i>( zquery -- n )</i>
<br>

Вернуть число. Запрос должен возвращать ровно одно поле, которое должно 
быть числовым или может быть преобразовано в число.
</DIV>


<DIV class=word>
<u>ask-string</u> <i>( zquery buf --  )</i>
<br>

Возвращает строку из базы в указанный буфер. Строка будет заканчиваться 
нулевым символом.
</DIV>


<DIV class=word>
<u>fill-ctl</u> <i>( zquery ctl --  )</i>
<br>

Запрашивает в базе строку и устанавливает ее в качестве заголовка элемента 
управления.
</DIV>


<DIV class=word>
<u>fill-combo</u> <i>( zquery ctl --  )</i>
<br>

Запрашивает в базе данных несколько строк и заносит их по порядку в выпадающий 
список.
</DIV>


<DIV class=word>
<u>fill-table</u> <i>( zquery tbl --  )</i>
<br>

Запрашивает в базе данных набор полей и заносит по порядку их значения в 
предоставленную таблицу.
</DIV>


<DIV class=word>
<u>read-to-hash</u> <i>( zquery hash --  )</i>
<br>

Заносит в хэш-таблицу очередную запись данных. Для каждого поля создается 
два элемента хэш-таблицы: одно с именем поля и его содержимым, второе - с 
именем поля, к которому добавлен знак диеза "#" и содержимым - длиной 
поля.
</DIV>


<DIV class=word>
<u>insert-from-hash</u> <i>( table-name hash --  )</i>
<br>

Заносит содержимое хэша в указанную таблицы базы данных.
</DIV>


<a name="ext-date"></a>
<h3>4.3. Работа с датами</h3>

<p>Некоторые слова, упоминающиеся ниже, используют для представления 
даты/времени блок данных размеров в 16 байтов. Он обозначается в стековой 
нотации как <i>dt</i>.
</p>

<DIV class=word>
<u>today-datetime</u> <i>( dt --  )</i>
<br>

Возвращает текущую дату.
</DIV>


<DIV class=word>
<u>format-date</u> <i>( dt -- z )</i>
<br>

Форматирует указанную дату в соответствии с нашей традицией: 
день.месяц.год, разделенные точками.
</DIV>


<DIV class=word>
<u>format-sqldate</u> <i>( dt -- z )</i>
<br>

Форматирует указанную дату в соответствии с требованиями стандарта SQL: 
год, месяц, день, разделенные тире.
</DIV>


<DIV class=word>
<u>today-str</u> <i>( -- z )</i>
<br>

Возвращает отформатированное (по-нашему) представление сегодняшней даты.
</DIV>


<DIV class=word>
<u>>sqldate</u> <i>( z1 -- z2 )</i>
<br>

Преобразует строковое представление даты из нашего формата в формат SQL.
</DIV>


<DIV class=word>
<u>sqldate></u> <i>( z1 -- z2 )</i>
<br>

Преобразует строковое представление даты из формата SQL в наш формат .
</DIV>


<DIV class=word>
<u>day-of-week</u> <i>( dt -- n )</i>
<br>

Возвращает день недели (1 - понедельник, ..., 7 - воскресенье).
</DIV>


<DIV class=word>
<u>selected-date</u> <i>( ctl -- z )</i>
<br>

Запрашивает у элемента "календарь" выделенную дату и возвращает ее в виде 
строки.
</DIV>


<a name="ext-money"></a>
<h3>4.4. Работа с денежными суммами и другие слова</h3>


<DIV class=word>
<u>format-money</u> <i>( n -- z )</i>
<br>

Преобразует число в строку, отделяя две последнии цифры точкой.
</DIV>


<DIV class=word>
<u>unformat-money</u> <i>( z -- n )</i>
<br>

Переводит строку в число, игнорируя точку, которая может в ней 
встретиться.
</DIV>


<DIV class=word>
<u>z>n</u> <i>( z -- n )</i>
<br>

Преобразует строку в число.
</DIV>


<DIV class=word>
<u>ctl>n</u> <i>(  --  )</i>
<br>

Читает заголовок элемента управления и преобразует его в число.
</DIV>


<DIV class=word>
<u>ctl!n</u> <i>( n ctl --  )</i>
<br>

Форматирует указанное число как строку и заносит его в заголовок элемента 
управления.
</DIV>


<DIV class=word>
<u>ctl!$</u> <i>( n ctl --  )</i>
<br>

Форматирует указанное число как денежную сумму и заносит его в заголовок элемента 
управления.
</DIV>


<DIV class=word>
<u>?invalid</u> <i>( ? z -- ? )</i>
<br>

Вспомогательное слово: принимает флажок и строку. Если флажок равен 
Истине, показывает строку в окне сообщения. Флажок остается неизменным.
</DIV>


<DIV class=word>
<u>>flag</u> <i>( ? -- 0/1 )</i>
<br>

Преобразует фортовский логический флаг (<>0/0) в логический флаг SQL 
(1/0).
</DIV>


<a name="ext-sql"></a>
<h3>4.5. Форматирование запросов</h3>

<p>Для удобства форматирования SQL-запросов введено специальное слово, 
работающее примерно как <u>"</u> из библиотеки 
<a href="../~ac/lib/str.f">str.f</a>. В его границах 
пишется строка, в которую включены операторы форматирования в фигурных 
скобках. Внутри операторов располагаются любые выражения, высчитывающие 
объект, подлежащий форматированию. Оператор заканчивается спецификатором 
формата, указывающим тип данных и желаемое форматирование.
</p>

<DIV class=word>
<u><<<</u> <i>( ->">>>" --  )</i>
<br>

Начать описание форматной строки.
</DIV>


<p>Разрешаются следующие спецификаторы формата:
</p>

<table class=st>
<tr>
<th class=st>Формат
<th class=st>Нотация
<th class=st>Объяснение
<th class=st>Использует слово
<tr><td class=st1>:N<td class=st1>( n -- )<td class=st2>Число<td class=st2>z>n
<tr><td class=st1>:Z<td class=st1>( z -- )
<td class=st2>Строка<td class=st2>&nbsp;
<tr><td class=st1>:F<td class=st1>( ? -- )
<td class=st2>Логический флаг<td class=st2>>flag
<tr><td class=st1>:E<td class=st1>( ctl -- )
<td class=st2>Строка-заголовок элемента<td class=st2>-text@
<tr><td class=st1>:EN<td class=st1>( ctl -- )
<td class=st2>Строка-заголовок элемента, отформатированная как число<td class=st2>ctl>n

<tr><td class=st1>:T<td class=st1>( x y tbl -- )
<td class=st2>Ячейка таблицы<td class=st2>-isubitem@
<tr><td class=st1>:TN<td class=st1>( x y tbl -- )
<td class=st2>Ячейка таблицы, отформатированная как число<td 
class=st2>tablecol>n

<tr><td class=st1>:H<td class=st1>( S" name" data -- )
<td class=st2>Элемент хэш-таблицы<td class=st2>data@z
<tr><td class=st1>:HN<td class=st1>( S" name" data -- )
<td class=st2>Элемент хэш-таблицы, отформатированный как число<td 
class=st2>data@zn

</table>

<code><pre>
<<<
SELECT price*100 FROM pricelist 
WHERE paper='{0 2 pubs @ :T}' AND sunday={sunday? :F} 
AND page={where @ -selected@ :N}
>>>
</pre></code>


</body>
</html>

